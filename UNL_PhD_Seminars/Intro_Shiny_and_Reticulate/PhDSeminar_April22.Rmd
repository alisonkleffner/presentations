---
title: "Intro to Shiny and the Reticulate Package"
author: "Alison Kleffner"
date: '2022-04-22'
output: 
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Table of Contents

- Introduction to R Shiny

- Introduction to the Reticulate Package

- How can they work together
  - Case Study: DIFM Trial Design

---

## What is Shiny?

- Shiny is a framework for creating web applications with R
  
- No knowledge of HTML, JavaScript or the like required

- Easily Customizable to create 

- [Example](https://gpilgrim.shinyapps.io/SwimmingProject-Click/?_ga=2.109375237.1006925784.1650405184-114395697.1608150124)

---

## What is Shiny Made up of?

Two main components to each Shiny App

  + UI: the User Interface (what the User sees)
  
    - The UI is made up of [Widgets](https://shiny.rstudio.com/gallery/widget-gallery.html) where user can input desired information
    - All Inputs have similar structure: Input(inputID,Label,value,... )
    - 
  
  + Server: Code for how the app works (aka R Code)
    - Connects Input to Output
    - The inputID helps connect the user given input to the backend R Code
    - render functions create output of different types
    - Then in the UI, have an Output function where you want the given output to generate within your app. 

---

## Uses Reactive Programming

+ When an input changes, outputs associated with that input will also change

+ Code is only ran when necessary, so helpful to create a reactive graph so you understand how changing the inputs affects the outputs  

+ So unlike a R script, can't read it up and down to understand the code

---
## Basic Example 
From: [Mastering Shiny by Hadley Wickham](https://mastering-shiny.org/index.html)

```{r, eval=FALSE, echo=TRUE}
ui <- fluidPage(
  selectInput("dataset", label = "Dataset", choices = ls("package:datasets")),
  verbatimTextOutput("summary"),
  tableOutput("table")
)
```

```{r, eval=FALSE, echo=TRUE}

server <- function(input, output, session) {
  output$summary <- renderPrint({
    dataset <- get(input$dataset, "package:datasets")
    summary(dataset)
  })
  
  output$table <- renderTable({
    dataset <- get(input$dataset, "package:datasets")
    dataset
  })
}

```


---

## What is Reticualte?

- Let's say you are working on project where you need to use a mix of R and Python Functions

- It'd be quite the pain to go back and forth

- Solution - The Reticulate Package in R
  + This package creates a R Interaface to Python and allows you to "easily" go back and forth between the two of them.
  
- [Reticulate Website](https://rstudio.github.io/reticulate/index.html)
  
---

## What can Reticulate Do?

- Call Python from R in different ways

  + Source a Python script 
  
  + Use in R Markdown and R Shiny
  
  + Import Python modules
  
- Translate between R and Python Objects

- Create Python Virtual environments 

---

#Getting Started

```{r, eval=FALSE, echo=TRUE}
install.packages(reticulate) #get the reticulate package

#install python if don't have already
reticulate::install_miniconda() 

#find default version of python reticulate is using
Sys.which("python") 

#specify different version of python
use_python("path to alternative python version")

```



---

## Creating A Python Virtual Environment

If you are working on a project, you may want to create a python virtual environment 

[Configuring a virtual environment from reticulate website](https://rstudio.github.io/reticulate/articles/versions.html)

[How I did it](https://medium.com/co-learning-lounge/create-virtual-environment-python-windows-2021-d947c3a3ca78) (on Windows):
+ Create a Project in R Studio (File -> New Project)
+ In Anaconda Prompt
 - conda create --name [Virtual Environment Name] python=[Version you want to install]
 - conda activate [Virtual Environment Name]
 - load all necessary Python packages in here (conda install pkge)
+ In R Studio, connect to Python
  + Tools -> Project Options -> Python -> Conda Environments
+ Check connection using: py_config()

---

## Example from [Reticulate Website](https://rstudio.github.io/reticulate/index.html)

```{python, eval = FALSE, echo = TRUE}
import pandas
def read_flights(file):
  flights = pandas.read_csv(file)
  flights = flights[flights['dest'] == "ORD"]
  flights = flights[['carrier', 'dep_delay', 'arr_delay']]
  flights = flights.dropna()
  return flights

```

```{r, eval=FALSE, echo = TRUE}
source_python("flights.py")
flights <- read_flights("flights.csv")

library(ggplot2)
ggplot(flights, aes(carrier, arr_delay)) + geom_point() + geom_jitter()

```


---

## Data Intensive Farm Managment Project (DIFM)

+ Precision Agriculture research seeks to develop new strategies to increase crop yield and profitability [[Source]](https://sustainableamerica.org/blog/what-is-precision-agriculture/)

+ Generally this is conducted through on-farm networks, which involves farmers conducting experiments under local conditions

  - Generates site-specific data for crop yield for different inputs (think like treatments)

+ DIFM is a grant with the funding going towards running these on-farm precision experiments and developing infrastructure to do so. 


---

## So What am I Doing?

+ Create a R Shiny application that will create the experimental design based on site-specific inputs the farmer enters.
  - Code is written in both R and Python (depends on the crop)
+ Farmer will enter inputs:
  - File that contains the coordinates of their field boundary
  - How big they desire their experimental plots to be
  - What treatment they desire to use and the different rates
  - Specifics about their tractor
  - Ab-line file 
+ Farmers will receive:
  + shp and ab-line files that they can put in their tractor in order to enact the experimental design on their field. 
  
---

## End Goal

+ Eventually hook my Shiny app up to their database and after harvest crop yields can be matched with the corresponding farm and it's design.

+ Then the data can begin to be analyzed (not my job), to hopefully aid in the development of strategies to increase profitability

---

## The User Interface

+ The design of the UI is the focus of my research

+ Goal is develop an interface that Farmers will be able to easily navigate through

  - Conference in June where will get feedback
  
+ Future Work:
  
  - Keep working on usability of my application
  
  - Visualizing spatial correlations

---

## Now Let's look at my App!


---

## Helpful Resources:

+ Shiny
 - [Shiny Cheatsheet](https://shiny.rstudio.com/articles/cheatsheet.html) 
 - [RStudio Tutorial](http://shiny.rstudio.com/tutorial/) 
 - [Widgets](http://shiny.rstudio.com/gallery/widget-gallery.html)
 - [Mastering Shiny by Hadley Wickham](https://mastering-shiny.org/index.html)
 - [Deploy your application](https://www.rstudio.com/products/shinyapps/)
 
+ Reticulate
  - [Reticulate Website](https://rstudio.github.io/reticulate/index.html)
  - [Getting started with Python using R and Reticulate](https://www.r-bloggers.com/2022/04/getting-started-with-python-using-r-and-reticulate/)
  - [Reticulate Cheatsheet](https://ugoproto.github.io/ugo_r_doc/pdf/reticulate.pdf)
  - [Reticulate Introduction](https://mran.microsoft.com/snapshot/2017-11-04/web/packages/reticulate/vignettes/introduction.html)