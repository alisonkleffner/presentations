---
title: "Redesigning Yield Map Plots for Comprehension and Usability"
subtitle: "Texas Christian University"
author: "Alison Kleffner"
date: "Department of Statistics, University of Nebraska - Lincoln"
output:
  xaringan::moon_reader:
    seal: false
    includes:
      after_body:
        "js-addins.html"
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    css: ["default", "metropolis-fonts", "metropolis" ,"css/modal.css", "css/sizeformat.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightlines: true
      countIncrementalSlides: true
---
class:title-slide-custom

```{r, child = "style.Rmd"}
```


```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
# Packages
library(emoji)
library(purrr)
library(tidyverse)
library(gridExtra)
library(nullabor)
library(scales)
library(knitr)
library(kableExtra)
library(RefManageR)
library(iconr)
library(fontawesome)
library(shiny)
# download_fontawesome()

# References
bib <- ReadBib("bib/thesis.bib", check = FALSE)
ui <- "- "

# R markdown options
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE, 
                      cache = TRUE,
                      dpi = 300)
options(htmltools.dir.version = FALSE)
options(knitr.kable.NA = '')
```

```{r, include = F, eval = T, cache = T}
clean_file_name <- function(x) {
  basename(x) %>% str_remove("\\..*?$") %>% str_remove_all("[^[A-z0-9_]]")
}
img_modal <- function(src, alt = "", id = clean_file_name(src), other = "") {
  
  other_arg <- paste0("'", as.character(other), "'") %>%
    paste(names(other), ., sep = "=") %>%
    paste(collapse = " ")
  
  js <- glue::glue("<script>
        /* Get the modal*/
          var modal{id} = document.getElementById('modal{id}');
        /* Get the image and insert it inside the modal - use its 'alt' text as a caption*/
          var img{id} = document.getElementById('img{id}');
          var modalImg{id} = document.getElementById('imgmodal{id}');
          var captionText{id} = document.getElementById('caption{id}');
          img{id}.onclick = function(){{
            modal{id}.style.display = 'block';
            modalImg{id}.src = this.src;
            captionText{id}.innerHTML = this.alt;
          }}
          /* When the user clicks on the modalImg, close it*/
          modalImg{id}.onclick = function() {{
            modal{id}.style.display = 'none';
          }}
</script>")
  
  html <- glue::glue(
     " <!-- Trigger the Modal -->
<img id='img{id}' src='{src}' alt='{alt}' {other_arg}>
<!-- The Modal -->
<div id='modal{id}' class='modal'>
  <!-- Modal Content (The Image) -->
  <img class='modal-content' id='imgmodal{id}'>
  <!-- Modal Caption (Image Text) -->
  <div id='caption{id}' class='modal-caption'></div>
</div>
"
  )
  write(js, file = "js-addins.html", append = T)
  return(html)
}
# Clean the file out at the start of the compilation
write("", file = "js-addins.html")
```

<br><br><br>
## Redesigning Yield Map Plots for Comprehension and Usability
### Texas Chirstian University
#### Alison Kleffner
#### Department of Statistics, University of Nebraska - Lincoln
##### `r fa("envelope", fill = "black")` [akleffner@huskers.unl.edu](akleffner@huskers.unl.edu)
##### `r fa("home", fill = "black")` [https://alison-kleffner.netlify.app/](https://alison-kleffner.netlify.app/)
##### `r fa("github", fill = "black")` [alisonkleffner](https://github.com/alisonkleffner)
<br><br>
.medium[*Slides: https://bit.ly/slide-url*]

---
class:primary
# Outline

`r fa_i("chart-bar")` What makes a Good Graph?

`r fa_i("list")` Redesigning Yield Plots

---
class:inverse
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
.center[
# What makes a good graph?
]

---
class:primary
# Why visualize?

What are graphics useful for?
+ Data cleaning
+ Exploring data structure
+ Communicating Information

Visualization offers an alternative way of communicating numbers

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/Minard.png", alt = "Napoleon March Map",other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```

[Napoleon March Map](https://en.wikipedia.org/wiki/Charles_Joseph_Minard) by Charles Joseph Minard

]

---
class:primary
# Example: Anscombe's Quartet

-  4 data sets that have nearly identical simple statistical properties that appear very different when graphed

- demonstrate both the importance of graphing data before analyzing it and the effect of outliers on statistical properties

- 11 (x,y) points

- the same mean, median, standard deviation, and correlation coefficient between x and y

---
class:primary
# Anscombe's Quartet: data

.pull-left[
.pull-left[
```{r, anscombe-set1}
quartet_setI <- anscombe %>%
  select(x1, y1) %>%
  mutate(set = "I") %>%
  rename(x = x1, 
         y = y1)
quartet_setI %>% select(x, y) %>% knitr::kable(caption = "Set I")
```
].pull-right[
```{r anscombe-set2}
quartet_setII <- anscombe %>%
  select(x2, y2) %>%
  mutate(set = "II") %>%
  rename(x = x2, 
         y = y2)
quartet_setII %>% select(x, y) %>% knitr::kable(caption = "Set II")
```
]].pull-right[
.pull-left[
```{r anscombe-set3}
quartet_setIII <- anscombe %>%
  select(x3, y3) %>%
  mutate(set = "III") %>%
  rename(x = x3, 
         y = y3)
quartet_setIII %>% select(x, y) %>% knitr::kable(caption = "Set III")
```
].pull-right[
```{r anscombe-set4}
quartet_setIV <- anscombe %>%
  select(x4, y4) %>%
  mutate(set = "IV") %>%
  rename(x = x4, 
         y = y4)
quartet_setIV %>% select(x, y) %>% knitr::kable(caption = "Set IV")
```
]]

---
class:primary
# Anscombe's Quartet: summary statistics

<br>
<br>

```{r, quartet-summary}
quartet <- rbind(quartet_setI,
                 quartet_setII,
                 quartet_setIII,
                 quartet_setIV) %>%
  select(set, x, y)

quartet_summary <- quartet %>%
  group_by(set) %>%
  summarize("mean(x)"  = round(mean(x),2), 
            "sd(x)"    = round(sd(x),2), 
            "mean(y)"  = round(mean(y),2), 
            "sd(y)"    = round(sd(y),2), 
            "cor(x,y)" = round(cor(x,y),2)) %>% 
  t()

colnames(quartet_summary) <- quartet_summary[1,]
quartet_summary <- quartet_summary[-1,] %>%
  as.data.frame()

quartet_summary %>%
  knitr::kable(digits = 2)
```
???

each data set has the same mean, standard deviation, and correlation coefficient between x and y.
 
---
class:primary
# Anscombe's Quartet: plots

```{r, , quartet-plots, fig.height = 4, fig.width = 6, fig.align = "center"}
ggplot(quartet, aes(x, y)) + 
  geom_point(colour = "green4", size = 2.5) + 
  geom_smooth(method = lm, se = FALSE, colour = "gray", alpha = .5) +
  facet_wrap(~ set) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text = element_text(size = 14),
        axis.title = element_text(size = 14),
        strip.text = element_text(size = 14))
```



---
class:primary
# Good Graphs

Good Graphs take advantage of how the brain works:
1. Preattentive Processing
2. Perceptual Grouping
3. Awareness of Visual Limitations

---
class:primary
# Find the Target

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/circle1.png", alt = "Find the Red Circle", other=list(width="40%"))
i2 <- img_modal(src = "images/circle2.png", alt = "Find the Red Circle", other=list(width="40%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i2, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9],
  str_split(i2, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

---
class:primary
# Preattentive Perception


---
class:primary
# Perceptual Grouping



---
class:primary
# Visual Limitations

---
class:primary
# Accuracy of Graphical Judgements


---
# Designing for Accessibility



---
class:inverse
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
.center[
# Yield Plots Redesign
]

---
class:primary
# Data Intensive Farm Management (DIFM)

+ On-Farm Precision Experimentation
  - Run OFPEs and develop infrastructure to develop and analyze these experiments
  - Conduct experiments on a field using field specific inputs and GPS-reliant technology
+ Want to learn the economically optimal treatment rate to increase efficiency while also reducing negative environmental impacts
+ Precision agriculture is used to elaborate strategies to make efficient use of available farming resources

---
class:primary
# Trial Design

[Trial Design Tool](http://trialdesign.difm-cig.org/)

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/Trial_Design.png", alt = "Example of A Trial Design",other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

---
class:primary
# Data Collection

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/data_collection.png", alt = "How Data is collected",other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]


---
class:primary
# Goal

+ Help explain the optimal decision management decisions, accounting for environmental and economic conditions, the range of possible weather, and other factors
  - Create a user interface, designed around explaining machine learning output to non-experts helping to build trust in the model predictions without requiring farmers to learn the details of statistical modeling
+ Want to learn how crop yield respond to different input application rates, field characteristics, and weather to hopefully increase profits
+ One way to begin to explore the relationship between input application and yield is through a graph.
  - Want to show the spatial correlations between the as applied factors and yield in a way that is understandable to farmers and consultants, not spatial statisticians
+ Develop perceptually optimal plots that communicate this relationship. 

---
class:primary
#What is currently being used

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/old_map.png", alt = "Example 1", other=list(width="30%"))
i2 <- img_modal(src = "images/juxtaposed-ex.jpeg", alt = "Example 2", other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i2, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9],
  str_split(i2, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]


---
class:primary
#Juxtaposed vs Superimposed Graphs

+ Juxtaposed graphs - side by side `r Citep(bib[[c("gleicher2011")]])`
  - Benefits: less issues with visual clutter and easier to create
  - Drawbacks: comparative burden is placed on the user
+ Superimposed graphs - multiple objects in same coordinate system `r Citep(bib[[c("gleicher2011")]])`
  - Benefits: Easier to compare as users can use perception rather than memory
  - Drawbacks: Issues with clutter
  - Useful when spatial location is a key component of the comparison `r Citep(bib[[c("Wang2018TowardsEC")]])`
  

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/jux-vs-sup.png", alt = "Juxtaposed vs Superimposed Comparative Graphs (Gleicher, Albers, Walker, et al., 2011)",other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]




---
class:primary
#Data Clutter with Superimposed Graphs

+ General principle of Graphical Design: Show data clearly `r Citep(bib[[c("cleveland_1984", "gordon_2015")]])`
+ Overlap - multiple dots on top of one another
  - obscures true number of dots
  - Visual cues, like color, becomes partially obstructed, thereby reducing search efficiency `r Citep(bib[[c("BRAVO2004b", "BRAVO2004a")]])`
  - Solutions include: jittering, distortion, refinement, and aggregation `r Citep(bib[[c("chua_2017")]])`
  - Can overburden human perception, causing errors in performing tasks `r Citep(bib[[c("huang2009")]])`
  
.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/old_map.png", alt = "Example 1", other=list(width="25%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]


---
class:primary
#Number of Categories

+ Number of categorical scales should be limited to 5-7 categories
 - This is due to working memory limits as it is harder for the user to distinguish between colors and remember the meaning of colors. Hence, it is more difficult to
 associate a color with the correct yield category `r Citep(bib[[c("macdonald_1999")]])`
  - Practically, the load on the userâ€™s working memory then increases the comprehensive time of the plot `r Citep(bib[[c("vanderplas2020")]])`

---
class:primary
#Redesign: Iteration 1


---
class:inverse
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
.center[
# Future Work
]

---
class:primary
# References
<font size="2">
```{r, print_refs1, results='asis', echo=FALSE, warning=FALSE, message=FALSE}
print(bib[[c("vonbergmann_2021")]], 
      .opts = list(check.entries = FALSE, style = "html", bib.style = "authoryear")
      )
```
</font>

---
class:inverse
<br>
<br>
<br>
.center[
# Questions?
<br>
<br>
`r fa("envelope", fill = "white")` **akleffner@huskers.unl.edu**
`r fa("home", fill = "white")` **https://alison-kleffner.netlify.app/**
`r fa("github", fill = "white")` **alisonkleffner**
]
