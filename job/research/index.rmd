---
title: "Redesigning Yield Map Plots for Comprehension and Usability"
subtitle: "Texas Christian University"
author: "Alison Kleffner"
date: "Department of Statistics, University of Nebraska - Lincoln"
output:
  xaringan::moon_reader:
    seal: false
    includes:
      after_body:
        "js-addins.html"
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"
    css: ["default", "metropolis-fonts", "metropolis" ,"css/modal.css", "css/sizeformat.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightlines: true
      countIncrementalSlides: true
---
class:title-slide-custom

```{r, child = "style.Rmd"}
```


```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
# Packages
library(emoji)
library(purrr)
library(tidyverse)
library(gridExtra)
library(nullabor)
library(scales)
library(knitr)
library(kableExtra)
library(RefManageR)
library(iconr)
library(fontawesome)
library(shiny)
library(RColorBrewer)
# download_fontawesome()

# References
bib <- ReadBib("bib/thesis.bib", check = FALSE)
ui <- "- "

# R markdown options
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE, 
                      cache = TRUE,
                      dpi = 300)
options(htmltools.dir.version = FALSE)
options(knitr.kable.NA = '')
```

```{r, include = F, eval = T, cache = T}
clean_file_name <- function(x) {
  basename(x) %>% str_remove("\\..*?$") %>% str_remove_all("[^[A-z0-9_]]")
}
img_modal <- function(src, alt = "", id = clean_file_name(src), other = "") {
  
  other_arg <- paste0("'", as.character(other), "'") %>%
    paste(names(other), ., sep = "=") %>%
    paste(collapse = " ")
  
  js <- glue::glue("<script>
        /* Get the modal*/
          var modal{id} = document.getElementById('modal{id}');
        /* Get the image and insert it inside the modal - use its 'alt' text as a caption*/
          var img{id} = document.getElementById('img{id}');
          var modalImg{id} = document.getElementById('imgmodal{id}');
          var captionText{id} = document.getElementById('caption{id}');
          img{id}.onclick = function(){{
            modal{id}.style.display = 'block';
            modalImg{id}.src = this.src;
            captionText{id}.innerHTML = this.alt;
          }}
          /* When the user clicks on the modalImg, close it*/
          modalImg{id}.onclick = function() {{
            modal{id}.style.display = 'none';
          }}
</script>")
  
  html <- glue::glue(
     " <!-- Trigger the Modal -->
<img id='img{id}' src='{src}' alt='{alt}' {other_arg}>
<!-- The Modal -->
<div id='modal{id}' class='modal'>
  <!-- Modal Content (The Image) -->
  <img class='modal-content' id='imgmodal{id}'>
  <!-- Modal Caption (Image Text) -->
  <div id='caption{id}' class='modal-caption'></div>
</div>
"
  )
  write(js, file = "js-addins.html", append = T)
  return(html)
}
# Clean the file out at the start of the compilation
write("", file = "js-addins.html")
```

<br><br><br>
## Redesigning Yield Map Plots for Comprehension and Usability
### Texas Chirstian University
#### Alison Kleffner
#### Department of Statistics, University of Nebraska - Lincoln
##### `r fa("envelope", fill = "black")` [akleffner@huskers.unl.edu](akleffner@huskers.unl.edu)
##### `r fa("home", fill = "black")` [https://alison-kleffner.netlify.app/](https://alison-kleffner.netlify.app/)
##### `r fa("github", fill = "black")` [alisonkleffner](https://github.com/alisonkleffner)
<br><br>
.medium[*Slides: https://bit.ly/slide-url*]

---
class:primary
# Outline

`r fa_i("chart-bar")` What makes a Good Graph?

`r fa_i("list")` Redesigning Yield Plots

---
class:inverse
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
.center[
# What makes a good graph?
]

---
class:primary
# Why visualize?

What are graphics useful for?
+ Data cleaning
+ Exploring data structure
+ Communicating Information

Visualization offers an alternative way of communicating numbers

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/Minard.png", alt = "Napoleon March Map",other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```

[Napoleon March Map](https://en.wikipedia.org/wiki/Charles_Joseph_Minard) by Charles Joseph Minard

]

---
class:primary
# Example: Anscombe's Quartet

-  4 data sets that have nearly identical simple statistical properties that appear very different when graphed

- demonstrate both the importance of graphing data before analyzing it and the effect of outliers on statistical properties

- 11 (x,y) points

- the same mean, median, standard deviation, and correlation coefficient between x and y

---
class:primary
# Anscombe's Quartet: data

.pull-left[
.pull-left[
```{r, anscombe-set1}
quartet_setI <- anscombe %>%
  select(x1, y1) %>%
  mutate(set = "I") %>%
  rename(x = x1, 
         y = y1)
quartet_setI %>% select(x, y) %>% knitr::kable(caption = "Set I")
```
].pull-right[
```{r anscombe-set2}
quartet_setII <- anscombe %>%
  select(x2, y2) %>%
  mutate(set = "II") %>%
  rename(x = x2, 
         y = y2)
quartet_setII %>% select(x, y) %>% knitr::kable(caption = "Set II")
```
]].pull-right[
.pull-left[
```{r anscombe-set3}
quartet_setIII <- anscombe %>%
  select(x3, y3) %>%
  mutate(set = "III") %>%
  rename(x = x3, 
         y = y3)
quartet_setIII %>% select(x, y) %>% knitr::kable(caption = "Set III")
```
].pull-right[
```{r anscombe-set4}
quartet_setIV <- anscombe %>%
  select(x4, y4) %>%
  mutate(set = "IV") %>%
  rename(x = x4, 
         y = y4)
quartet_setIV %>% select(x, y) %>% knitr::kable(caption = "Set IV")
```
]]

---
class:primary
# Anscombe's Quartet: summary statistics

<br>
<br>

```{r, quartet-summary}
quartet <- rbind(quartet_setI,
                 quartet_setII,
                 quartet_setIII,
                 quartet_setIV) %>%
  select(set, x, y)

quartet_summary <- quartet %>%
  group_by(set) %>%
  summarize("mean(x)"  = round(mean(x),2), 
            "sd(x)"    = round(sd(x),2), 
            "mean(y)"  = round(mean(y),2), 
            "sd(y)"    = round(sd(y),2), 
            "cor(x,y)" = round(cor(x,y),2)) %>% 
  t()

colnames(quartet_summary) <- quartet_summary[1,]
quartet_summary <- quartet_summary[-1,] %>%
  as.data.frame()

quartet_summary %>%
  knitr::kable(digits = 2)
```
???

each data set has the same mean, standard deviation, and correlation coefficient between x and y.
 
---
class:primary
# Anscombe's Quartet: plots

```{r, , quartet-plots, fig.height = 4, fig.width = 6, fig.align = "center"}
ggplot(quartet, aes(x, y)) + 
  geom_point(colour = "green4", size = 2.5) + 
  geom_smooth(method = lm, se = FALSE, colour = "gray", alpha = .5) +
  facet_wrap(~ set) +
  theme_bw() +
  theme(aspect.ratio = 1,
        axis.text = element_text(size = 14),
        axis.title = element_text(size = 14),
        strip.text = element_text(size = 14))
```



---
class:primary
# Good Graphs

Good Graphs take advantage of how the brain works:
1. Preattentive Processing
2. Perceptual Grouping
3. Awareness of Visual Limitations

---
class:primary
# Find the Target

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/circle1.png", alt = "Find the Red Circle", other=list(width="40%"))
i2 <- img_modal(src = "images/circle2.png", alt = "Find the Red Circle", other=list(width="40%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i2, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9],
  str_split(i2, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

---
class:primary
# Preattentive Processing

Pre-Attentive Features are things that "jump out" in less than 250 ms

  - Color, shape, angle, movement, spatial localization

There is a hierarchy of features

 - Color is stronger than shape
 
Reduces the amount of work your views have to do when view your chart

---
class:primary
# Perceptual Grouping

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/gestalt.png", alt = "Gestalt Laws of Perception",other=list(width="70%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

+ Proximity: Things that are spatially near to one another are related
+ Similarity: Thing that look alike are related
+ Closure: Incomplete items are seen as complete
+ Enclosure: Related elements are surrounded with a visual element

---
class:primary
# Example of Gestalt in Data Visualization

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/gestalt-viz.png", alt = "Gestalt Laws of Proximity and Similarity",other=list(width="70%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

+ Proximity
+ Similarity

---
class:primary
# Visual Limitations

Not all graphical representations are equally accurate
 
Designing Plots for disabilities
- Low visual activity
  + High contrast (bright/dark)
  + large font size
  + textures/patterns can be hard to make out
- Color-blindness


---
class:primary
# Accuracy of Graphical Judgements 

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/percep-tasks.png", alt = "Types of Graphical Judgements (Cleveland and McGill, 1984)",other=list(width="30%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]
Rankings `r Citep(bib[[c("cleveland_mcgill_1984")]])`: 
1. Position along a common scale (most accurate)
2. Positions along nonaligned scales
3. Length (bar chart)
4. Angle, Slope (pie chart)
5. Area (bubble chart)
6. Volume, Density, Color saturation (heatmap)
7. Color hue (least accurate)

---
class:primary
# Color

+ Hue: shade of color
+ Color and hue are pre-attentive
  - Bigger contrasts correspond to faster detection
+ Want color mapping to be perceptually optimal
+ Be conscious on what color means
+ Avoid rainbow gradients

---
class:primary
#Gradients

Qualitative schemes: no more than 7 colors

```{r, echo=FALSE, fig.width=3, fig.height=1, out.height="35%", out.width="35%"}
data <- data.frame(x = 1:7, 
                   blues = brewer.pal(7, "Blues"), 
                   set1 = brewer.pal(7, "Set1"), 
                   diverge = brewer.pal(7,"RdBu"))

qplot(xmin = x-.5, xmax = x+.5, ymin = 0, ymax = 1, data = data, geom = "rect", color = I("black"), fill = set1) + 
    scale_fill_identity() + 
    ylab("") + 
    xlab("") + 
    theme(axis.text = element_blank(), 
          axis.ticks = element_blank(), 
          rect = element_blank()) + 
    coord_fixed(ratio = 1) + 
    theme_void()
```

Quantitative schemes: use color gradient with only one hue for positive values

```{r, echo=FALSE, fig.width=3, fig.height=1, out.height="35%",  out.width="35%"}
qplot(xmin = x-.5, xmax = x+.5, ymin = 0, ymax = 1, data = data, geom = "rect", color = I("black"), fill = blues) + 
    scale_fill_identity() + 
    ylab("") + 
    xlab("") + 
    theme(axis.text = element_blank(), 
          axis.ticks = element_blank(), 
          rect = element_blank()) + 
    coord_fixed(ratio = 1) + 
    theme_void()
```


Quantitative schemes: use color gradient with two hues for positive and negative values. Gradient should go through a light, neutral color (white)

```{r, echo=FALSE, fig.width=3, fig.height=1, out.height="35%", out.width="35%"}
qplot(xmin = x-.5, xmax = x+.5, ymin = 0, ymax = 1, data = data, geom = "rect", color = I("black"), fill = diverge) + 
    scale_fill_identity() + 
    ylab("") + 
    xlab("") + 
    theme(axis.text = element_blank(), 
          axis.ticks = element_blank(), 
          rect = element_blank()) + 
    coord_fixed(ratio = 1) + 
    theme_void()
```


---
class:primary
#Color Blindness

Not everyone perceives color in the same way. Some individuals have [colorblindness or color deficiencies](https://en.wikipedia.org/wiki/Color_blindness).

You can take a test designed to screen for colorblindness [here](https://www.eyeque.com/color-blind-test/test/).


+ Safest: design for a black-and-white photocopier
+ If you need a 2-color gradient, use blue/purple - white - orange (safe for most types of colorblindness)
+ double encoding - where you use color, use another aesthetic (line type, shape)
+ If you are using a color gradient, use a monochromatic color scheme where possible.


---
class:inverse
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
.center[
# Yield Plots Redesign
]

---
class:primary
# Data Intensive Farm Management (DIFM)

+ On-Farm Precision Experimentation
  - Run OFPEs and develop infrastructure to develop and analyze these experiments
  - Conduct experiments on a field using field specific inputs and GPS-reliant technology
+ Want to learn the economically optimal treatment rate to increase efficiency while also reducing negative environmental impacts
+ Precision agriculture is used to elaborate strategies to make efficient use of available farming resources

---
class:primary
# Trial Design

[Trial Design Tool](http://trialdesign.difm-cig.org/)

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/Trial_Design.png", alt = "Example of A Trial Design",other=list(width="60%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

---
class:primary
# Data Collection

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/data_collection.png", alt = "How Data is collected",other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]


---
class:primary
# Goal

+ Help explain the optimal decision management decisions, accounting for environmental and economic conditions, the range of possible weather, and other factors
  - Create a user interface, designed around explaining machine learning output to non-experts helping to build trust in the model predictions without requiring farmers to learn the details of statistical modeling
+ Want to learn how crop yield respond to different input application rates, field characteristics, and weather to hopefully increase profits
+ One way to begin to explore the relationship between input application and yield is through a graph.
  - Want to show the spatial correlations between the as applied factors and yield in a way that is understandable to farmers and consultants, not spatial statisticians
+ Develop perceptually optimal plots that communicate this relationship. 

---
class:primary
#What is currently being used

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/old_map.png", alt = "Example 1", other=list(width="30%"))
i2 <- img_modal(src = "images/juxtaposed-ex.jpeg", alt = "Example 2", other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i2, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9],
  str_split(i2, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

---
class:primary
# Other Yield Plots in Literature

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/yield-plot1.png", alt = "Zhang, Li, Liu, and Wang (2008)", other=list(width="30%"))
i2 <- img_modal(src = "images/yield-plot2.png", alt = "Searcy (1997)", other=list(width="30%"))
i3 <- img_modal(src = "images/yield-plot3.png", alt = "www.aspexit.com", other=list(width="30%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i2, "\\n", simplify = T)[1:2],
  str_split(i3, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9],
  str_split(i2, "\\n", simplify = T)[3:9],
  str_split(i3, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

Plenty of  other iterations of yield maps used in the literature. Here's some examples

---
class:primary
#Juxtaposed vs Superimposed Graphs

+ Juxtaposed graphs - side by side `r Citep(bib[[c("gleicher2011")]])`
  - Benefits: less issues with visual clutter and easier to create
  - Drawbacks: comparative burden is placed on the user
+ Superimposed graphs - multiple objects in same coordinate system `r Citep(bib[[c("gleicher2011")]])`
  - Benefits: Easier to compare as users can use perception rather than memory
  - Drawbacks: Issues with clutter
  - Useful when spatial location is a key component of the comparison `r Citep(bib[[c("Wang2018TowardsEC")]])`
  
.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/jux-vs-sup.png", alt = "Juxtaposed vs Superimposed Comparative Graphs (Gleicher, Albers, Walker, et al., 2011)",other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]




---
class:primary
#Data Clutter with Superimposed Graphs

+ General principle of Graphical Design: Show data clearly `r Citep(bib[[c("cleveland_1984", "gordon_2015")]])`
+ Overlap - multiple dots on top of one another
  - obscures true number of dots
  - Visual cues, like color, becomes partially obstructed, thereby reducing search efficiency `r Citep(bib[[c("BRAVO2004b", "BRAVO2004a")]])`
  - Solutions include: jittering, distortion, refinement, and aggregation `r Citep(bib[[c("chua_2017")]])`
  - Can overburden human perception, causing errors in performing tasks `r Citep(bib[[c("huang2009")]])`
  
.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/old_map.png", alt = "Example 1", other=list(width="25%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]


---
class:primary
#Number of Categories

+ Number of categorical scales should be limited to 5-7 categories
 - This is due to working memory limits as it is harder for the user to distinguish between colors and remember the meaning of colors. Hence, it is more difficult to
 associate a color with the correct yield category `r Citep(bib[[c("macdonald_1999")]])`
  - Practically, the load on the userâ€™s working memory then increases the comprehensive time of the plot `r Citep(bib[[c("vanderplas2020")]])`
  

---
class:primary
#Redesign: Iteration 1

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/Attempt1.png", alt = "First Iteration", other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

+ Superimposed the treatment and yield plots
+ Use of transparency to show both at same time
+ Interactive plot with *leaflet*
  - Can add and remove plot layer
+ Work that still needs to be done
  - Color needs some work (no bivariate scale)
  - Maybe not as good for paper plots

---
class:primary
#Redesign: Iteration 2

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/Attempt2_1.jpeg", alt = "Second Iteration", other=list(width="50%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

+ Discrete Scale for Trial Design 
 
---
class:primary
#Redesign: Correlation between as Applied and treatment

.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/corr-plot1.jpeg", alt = "Correlation", other=list(width="60%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]

+ Bivariate color scale to show difference between positive and negative correlation values
+ Maintain some spatial information. 
  - Know which part of the field as correlations may be impacted by other things, like soil type. Eventually add that information to the plot. 

---
class:primary
# Conclusion

+ Designing graphics is a process
+ Our maps make improvements over the previous
  - Reduce Clutter on Superimposed graphics
  - Better colors
  - less categories
  

---
class:inverse
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
.center[
# Future Work
]

---
class:primary
#DIFM Project

+ Explain what the optimal decision management decisions are, accounting for environmental and economic conditions, the range of possible weather, and other factors.
  - Develop a R Shiny app to explaining machine learning output to non-experts helping to build trust in the model predictions without requiring farmers to learn the details of statistical modeling.
+ In general, want to lead this into work on spatial visualizations, especially in the comparative framework
  - Do testing on the graphics that I just made to see if farmers and consultants are interpreting the information correctly.

---
class:primary
#Remote Sensing Data: Arctic Sea Ice

+ Developing a non-stationary spatio-temporal model for Arctic Sea Ice motion
+ Process
  -  Cluster regions with similar spatio-temporal movement. The boundaries between clusters would be locations where ice cracks would form.
  - Model is developed within each cluster. 
  - Use the model to interpolate missing data, yielding a complete data set. 
  
.center[
```{r results='asis', echo = F, include = T, cache = T, eval = TRUE}
i1 <- img_modal(src = "images/data_example.jpeg", alt = "Missing Data in Sea Ice", other=list(width="30%"))
i2 <- img_modal(src = "images/traj_plot.png", alt = "Sea Ice Movement", other=list(width="30%"))

c(str_split(i1, "\\n", simplify = T)[1:2],
  str_split(i2, "\\n", simplify = T)[1:2],
  str_split(i1, "\\n", simplify = T)[3:9],
  str_split(i2, "\\n", simplify = T)[3:9]
  ) %>% paste(collapse = "\n") %>% cat()
```
]
---
class:primary
#Remote Sensing Data: Arctic Sea Ice

+ In the future
  - Bivariate Model
  - Find other applications
  - Computational efficiency (reduce to one-step)

---
class:primary
# References
<font size="2">
```{r, print_refs1, results='asis', echo=FALSE, warning=FALSE, message=FALSE}
print(bib[[c("vonbergmann_2021")]], 
      .opts = list(check.entries = FALSE, style = "html", bib.style = "authoryear")
      )
```
</font>

---
class:inverse
<br>
<br>
<br>
.center[
# Questions?
<br>
<br>
`r fa("envelope", fill = "white")` **akleffner@huskers.unl.edu**
`r fa("home", fill = "white")` **https://alison-kleffner.netlify.app/**
`r fa("github", fill = "white")` **alisonkleffner**
]
